@page "/portfolio"

@using Blazorise
@using Blazorise.TreeView;

<div class="container.is-fullhd">
    <div class="columns">
        <div class="column">
            <div class="card">
                <div class="card-content">
                    <div class="content">
                        <TreeView Nodes="_portfolioListResult"
                                  GetChildNodes="@(item => item.Children)"
                                  HasChildNodes="@(item => item.Children?.Any() == true)"
                                  @bind-SelectedNode="selectedPortfolio"
                                  @bind-ExpandedNodes="_expandedPortfolio">
                            <NodeContent>
                                <img class="icon-25" src="@PortfolioViewModel.GetIcon(context.Type)"/>
                                <span @onclick="() => OnHideCard(context)" class="ml-2 mr-2 has-text-weight-bold icon-pos"> @context.Text </span>
                                @if (context.Type != PortfolioType.Dataset)
                                {
                                    <img class="icon-25" src="_content/ClientUI.Components/icons/Add.png" @onclick="(() => ShowModal(context))"/>
                                }
                            </NodeContent>
                        </TreeView>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-two-thirds">
            <div class="card" hidden="@HideCard">
                <div class="card-content">
                    <div class="content">
                        <h4 class="mb-4"> @selectedPortfolio.Text </h4>
                        <div class="columns">
                            <div class="column">
                                <label>Description</label>
                                <img class="icon-25 is-pulled-right" src="_content/ClientUI.Components/icons/Save.png"/>
                                <article class="mt-2 message is-warning">
                                    <div class="message-body">
                                        @selectedPortfolio.Description
                                    </div>
                                </article>
                            </div>
                        </div>
                        <Tabs SelectedTab="@_selectedTab" SelectedTabChanged="@OnSelectedTab">
                            <Items>
                                <Tab Name="tab1">Input data structure</Tab>
                                <Tab Name="tab2">Transformations</Tab>
                                <Tab Name="tab3">Version history</Tab>
                            </Items>
                            <Content>
                                <TabPanel Name="tab1">
                                    <InputDataStructure></InputDataStructure>
                                </TabPanel>
                                <TabPanel Name="tab2">
                                    Content for Transformations.
                                </TabPanel>
                                <TabPanel Name="tab3">
                                    Version history.
                                </TabPanel>
                            </Content>
                        </Tabs>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <Modal @ref="_modalRefefence">
        <ModalContent Centered>
            <ModalHeader>
                <ModalTitle>@Localizer["AddPortfolio"]</ModalTitle>
            </ModalHeader>
            <ModalBody>
                <Field>
                    <FieldLabel>@Localizer["PortfolioName"]</FieldLabel>
                    <TextEdit @bind-Text="@_modalViewModel.Name" PlaceHolder="Name..."/>
                </Field>
                <Field>
                    <Select TValue="string" SelectedValueChanged="@OnChangeType">
                        @foreach (var type in _types)
                        {
                            <SelectItem Value=@type>@type</SelectItem>
                        }
                    </Select>
                </Field>
            </ModalBody>
            <ModalFooter>
                <Button Color="Color.Light" Clicked="@onModalCancel">@Localizer["Cancel"]</Button>
                <Button Color="Color.Success" Clicked="@onModalSave">@Localizer["Save"]</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>

</div>